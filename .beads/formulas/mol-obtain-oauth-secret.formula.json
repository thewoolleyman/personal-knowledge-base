{
  "formula": "mol-obtain-oauth-secret",
  "description": "Obtain OAuth credentials from a cloud provider and configure them locally. Reusable template for any OAuth-based service integration.",
  "version": 1,
  "type": "workflow",
  "vars": {
    "provider": {
      "description": "Cloud provider name (e.g., google, github, slack)",
      "required": true
    },
    "service": {
      "description": "Service name for display (e.g., Google Drive, Gmail)",
      "required": true
    },
    "console_url": {
      "description": "URL to the provider's developer console",
      "required": true
    },
    "apis": {
      "description": "Comma-separated list of APIs to enable",
      "required": true
    },
    "env_client_id": {
      "description": "Environment variable name for client ID",
      "required": true
    },
    "env_client_secret": {
      "description": "Environment variable name for client secret",
      "required": true
    },
    "scopes": {
      "description": "OAuth scopes needed (comma-separated)",
      "default": "readonly"
    },
    "app_type": {
      "description": "OAuth app type (desktop, web)",
      "default": "desktop"
    }
  },
  "steps": [
    {
      "id": "open-console",
      "title": "Open {{provider}} developer console",
      "type": "human",
      "description": "Open {{console_url}} and sign in. Create a project if needed."
    },
    {
      "id": "enable-apis",
      "title": "Enable {{apis}}",
      "type": "human",
      "description": "In APIs & Services > Library, search and enable each: {{apis}}.",
      "needs": ["open-console"]
    },
    {
      "id": "consent-screen",
      "title": "Configure OAuth consent screen",
      "type": "human",
      "description": "APIs & Services > OAuth consent screen. Choose External. Add app name, emails, scopes: {{scopes}}. Add your email as test user.",
      "needs": ["enable-apis"]
    },
    {
      "id": "create-credentials",
      "title": "Create OAuth client ID ({{app_type}} app)",
      "type": "human",
      "description": "APIs & Services > Credentials > Create Credentials > OAuth client ID. Type: {{app_type}}. Copy the Client ID and Client Secret.",
      "needs": ["consent-screen"]
    },
    {
      "id": "configure-env",
      "title": "Add credentials to .env",
      "description": "cp .env.example .env (if needed), then set {{env_client_id}} and {{env_client_secret}} in .env with the copied values.",
      "needs": ["create-credentials"]
    },
    {
      "id": "verify-auth",
      "title": "Run auth flow and verify",
      "type": "human",
      "description": "source .env && export {{env_client_id}} {{env_client_secret}} && make build && ./pkb auth. Then test: ./pkb search 'test query'",
      "needs": ["configure-env"]
    }
  ]
}
